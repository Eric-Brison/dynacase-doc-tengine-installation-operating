# Client::getInfo {#te-manex-ref:b46f0d87-2f97-4455-8e63-5defa94d8857}

<div class="short-description">
Récupérer les informations sur une tâche de transformation.
</div>

## Description {#te-manex-ref:fd132660-f49f-4252-a87d-ceb21d83ece9}

    [php]
    string getInfo ( string $tid,
                      array & $info )

Une fois la tâche soumise (à l'aide de
[`sendTransformation()][Client::sendTransformation]), le client peut interroger
régulièrement (ou dans le code exécuté par le callback du serveur TE) la tâche
à partir de son `tid` pour voir si elle est terminée (ou en attente, ou en
échec, etc.).

### Avertissements {#te-manex-ref:df34f5b1-8c52-416f-baf8-67d835354222}

## Liste des paramètres {#te-manex-ref:a159cce8-6fa4-4eb3-bcd9-49d52cadf125}

(string) `tid`
:   Identifiant de la tâche dont on souhaite obtenir les informations.

[out] (array) `info`
:   Informations retournées de la tâche.

## Valeur de retour {#te-manex-ref:8e65fa24-145c-44ec-9cc1-30dada5515f9}

La méthode `getInfo()` retourne une chaîne non vide, contenant le message
d'erreur, si la demande d'information a échoué, ou une chaîne vide si la
demande d'information est réussie.

Si la demande d'information est réussie, la variable `$info` contient les
informations de la tâche.

Les propriétés de `$info` peuvent être :

    [php]
    array(
        'tid'        => (string) $taskId,
        'infile'     => (string) $inputFile,
        'inmime'     => (string) $inputFileMimeType,
        'outfile'    => (string) $outputFile,
        'engine'     => (string) $transformationName,
        'status'     => (string) $status,
        'callback'   => (string) $clientCallbackURL,
        'callreturn' => (string) $callbackReturn,
        'fkey'       => (string) $clientForeignKey,
        'pid'        => (string) $transformationPID,
        'comment'    => (string) $transformationComment
    )


`tid`
:   Identifiant de la tâche.

`infile`
:   Chemin d'accès (sur le serveur) du fichier à transformer.

`inmime`
:   Type MIME du fichier à transformer.

`outfile`
:   Chemin du fichier résultat de la transformation.

`engine`
:   Moteur de transformation demandé par le client.

`status`
:   Status de la tâche (voir [`Cycle de traitement des demandes`][wflow_task]).
    
    Liste des constantes de statut de tâche : 
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_BEGINNING` (`B`)
    :   Demande de conversion reçue.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_TRANSFERRING` (`T\)
    :   Lecture/transfert du fichier à convertir.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_ERROR` (`K`)
    :   Erreur.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_SUCCESS` (`D`)
    :   Transformation réussie.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_PROCESSING` (`P`)
    :   En cours de traitement.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_WAITING` (`W`)
    :   Attente de traitement par le moteur.
    
    `\Dcp\TransformationEngine\Client::TASK_STATE_INTERRUPTED` (`I`)
    :   Interrompue.

`callback`
:   URL de callback fournie par le client.

`callreturn`
:   Message retourné par l'appel à l'URL de callback.

`fkey`
:   Clef `fkey` soumise par le client lors de la demande de transformation.

`pid`
:   Le PID du processus de transformation lorsque celui-ci tourne.

`comment`
:   Dernier message de la tâche.

## Erreurs / Exceptions {#te-manex-ref:b55b76f4-8eef-4256-8491-d09c2a6b6cac}

La méthode retourne une chaîne non vide contenant le message d'erreur si les
informations de la tâche n'ont pu être récupérées.

## Historique {#te-manex-ref:7bdd920c-8141-4b83-90c9-786d71e829a1}

## Exemples {#te-manex-ref:3a466331-e772-46c0-96c6-8290e94c363f}

    [php]
    $tid = '54c8a79a4780d2.85897641';
    $info = array();
    $err = $te->getInfo(
        $tid, /* Identifiant de la tâche qu'on souhaite interroger */
        $info
    );
    if ($err != '') {
        throw new Exception(sprintf("getInfo() returned with error: %s", $err));
    }
    var_export($info);

    [php]
    array (
      'tid' => "54c8a79a4780d2.85897641",
      'infile' => "/var/tmp/tes-6FDTUK.txt",
      'inmime' => "text/plain;",
      'outfile' => "/var/tmp/ter-xbpYHM.pdf",
      'engine' => "pdf",
      'status' => "D",
      'callback' => "",
      'callreturn' => "",
      'fkey' => "",
      'pid' => "15678",
      'comment' => "generated by [/opt/te/lib/engines/txt2pdf] command; "
    )

## Notes {#te-manex-ref:1cf77d30-6fd5-482b-a277-804d6960c78c}

## Voir aussi {#te-manex-ref:fa321665-ef71-4eda-96f3-5b2d711c357b}

- [`sendTransformation()`][Client::sendTransformation]
- [`Cycle de traitement des demandes`][wflow_task]

<!-- links -->
[Client::sendTransformation]: #te-manex-ref:adab03f2-0526-4d12-a28c-232a70a0fd8c
[wflow_task]: #te-manex-ref:099d71d4-76dc-41c9-aa19-9126fe7cb555
